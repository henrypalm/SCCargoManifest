<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>SC Cargo Manifest</title>
  <link rel="icon" href="logo.ico" type="image/x-icon" />
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #111;
      color: white;
      margin: 0;
      padding-bottom: 120px;
    }

    h1 {
      text-align: center;
      color: gold;
      padding-top: 1rem;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-bottom: 1rem;
    }

    th, td {
      padding: 0.5rem;
      border-bottom: 1px solid #444;
      text-align: left;
    }

    input, select {
      background-color: #222;
      color: white;
      border: 1px solid #444;
      padding: 0.3rem;
      border-radius: 4px;
      width: 100%;
    }

    .highlighted-text {
      color: white;
      background-color: black;
      padding: 0 0.2em;
    }

    #exportBox {
      position: sticky;
      bottom: 0;
      background: #222;
      padding: 1em;
      border-top: 2px solid #555;
      display: flex;
      justify-content: space-between;
      flex-wrap: wrap;
      gap: 1em;
      z-index: 999;
    }

    details {
      margin: 1rem;
      background: #1a1a1a;
      border: 1px solid #444;
      border-radius: 6px;
      padding: 0.5rem;
    }

    summary {
      font-weight: bold;
      font-size: 1.2rem;
      cursor: pointer;
      color: #0ff;
    }

    #grandTotalDisplay {
      font-size: 1.2rem;
      font-weight: bold;
      color: gold;
    }

    #manifestTitle {
      width: 50%;
      margin: 1rem auto;
      display: block;
      font-size: 1.2rem;
    }
  </style>
</head>
<body>
  <input type="text" id="manifestTitle" placeholder="Enter manifest title..." />
  <h1 id="manifestTitleDisplay">Cargo Manifest Calculator</h1>

  <details open>
    <summary>Ship Mining</summary>
    <table>
      <thead>
        <tr>
          <th>Item</th>
          <th>Quantity</th>
          <th>Location</th>
          <th>Unit Price<br>(choose size)</th>
          <th>Total</th>
        </tr>
      </thead>
      <tbody id="shipMiningBody"></tbody>
    </table>
  </details>

  <details open>
    <summary>Handheld and Light Ship Mining</summary>
    <table>
      <thead>
        <tr>
          <th>Item</th>
          <th>Quantity</th>
          <th>Location</th>
          <th>Unit Price<br>(choose size)</th>
          <th>Total</th>
        </tr>
      </thead>
      <tbody id="handMiningBody"></tbody>
    </table>
  </details>

  <details open>
    <summary>Salvage</summary>
    <table>
      <thead>
        <tr>
          <th>Item</th>
          <th>Quantity</th>
          <th>Location</th>
          <th>Unit Price<br>(choose size)</th>
          <th>Total</th>
        </tr>
      </thead>
      <tbody id="salvageBody"></tbody>
    </table>
  </details>

  <div id="exportBox">
    <button onclick="exportCSV()">Export CSV</button>
    <button onclick="exportTXT()">Export TXT</button>
    <button onclick="copyTXT()">Copy TXT to Clipboard</button>
    <div id="grandTotalDisplay">Total: 0 aUEC</div>
  </div>

  <script src="itemPrices.js"></script>
  <script src="itemColors.js"></script>
  <script>
    function formatNumberWithCommas(num) {
      return num.toLocaleString(undefined, {
        minimumFractionDigits: 0,
        maximumFractionDigits: 2
      });
    }
  
    function generateTXTContent() {
      const title = document.getElementById("manifestTitle").value || "Cargo Manifest";
      let content = `Title: ${title}\n\n`;
      let grandTotal = 0;
  
      const bodies = [
        { name: "Ship Mining", body: shipMiningBody },
        { name: "Handheld and Light Ship Mining", body: handMiningBody },
        { name: "Salvage", body: salvageBody }
      ];
  
      bodies.forEach(({ name, body }) => {
        const rows = Array.from(body.children).filter(row => {
          const qty = parseFloat(row.querySelector(".quantityInput").value) || 0;
          return qty > 0;
        });
  
        if (rows.length === 0) return;
  
        content += `Category: ${name}\n`;
  
        rows.forEach(row => {
          const item = row.querySelector(".itemSelect").textContent;
          const qty = parseFloat(row.querySelector(".quantityInput").value) || 0;
          const location = row.querySelector(".locationSelect").value;
          const scuSize = row.querySelector(".scuSelect").value;
          const unitPrice = parseFloat(row.querySelector(".unitPrice").textContent.replace(/,/g, '')) || 0;
          const total = qty * unitPrice;
          grandTotal += total;
  
          content += `${item} | Qty: ${qty} | Location: ${location} | Unit Price: ${formatNumberWithCommas(unitPrice)} aUEC (${scuSize.toUpperCase()}) | Total: ${formatNumberWithCommas(total)}\n`;
        });
  
        content += `\n`;
      });
  
      content += `Grand Total: ${formatNumberWithCommas(grandTotal)} aUEC\n`;
      return content;
    }
  
    function exportTXT() {
      const content = generateTXTContent();
      const title = document.getElementById("manifestTitle").value || "Cargo Manifest";
      const blob = new Blob([content], { type: "text/plain;charset=utf-8" });
      const link = document.createElement("a");
      link.href = URL.createObjectURL(blob);
      const timestamp = new Date().toISOString().replace(/[:.]/g, "-");
      link.download = `${title.replace(/\s+/g, "_")}_${timestamp}.txt`;
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
    }
  
    function copyTXT() {
      const content = generateTXTContent();
      navigator.clipboard.writeText(content)
        .then(() => alert("TXT content copied to clipboard!"))
        .catch(err => alert("Copy failed: " + err));
    }
  
    function exportCSV() {
      const title = document.getElementById("manifestTitle").value || "Cargo Manifest";
      let content = [["Category", "Item", "Qty", "Location", "Unit Price", "SCU Size", "Total"]];
      let grandTotal = 0;
  
      const bodies = [
        { name: "Ship Mining", body: shipMiningBody },
        { name: "Handheld and Light Ship Mining", body: handMiningBody },
        { name: "Salvage", body: salvageBody }
      ];
  
      bodies.forEach(({ name, body }) => {
        const rows = Array.from(body.children).filter(row => {
          const qty = parseFloat(row.querySelector(".quantityInput").value) || 0;
          return qty > 0;
        });
  
        rows.forEach(row => {
          const item = row.querySelector(".itemSelect").textContent;
          const qty = parseFloat(row.querySelector(".quantityInput").value) || 0;
          const location = row.querySelector(".locationSelect").value;
          const scuSize = row.querySelector(".scuSelect").value;
          const unitPrice = parseFloat(row.querySelector(".unitPrice").textContent.replace(/,/g, '')) || 0;
          const total = qty * unitPrice;
          grandTotal += total;
  
          content.push([name, item, qty, location, unitPrice, scuSize.toUpperCase(), total]);
        });
      });
  
      content.push(["", "", "", "", "", "Grand Total", grandTotal]);
  
      const csvString = content.map(row =>
        row.map(val => `"${String(val).replace(/"/g, '""')}"`).join(",")
      ).join("\n");
  
      const blob = new Blob([csvString], { type: "text/csv;charset=utf-8" });
      const link = document.createElement("a");
      link.href = URL.createObjectURL(blob);
      const timestamp = new Date().toISOString().replace(/[:.]/g, "-");
      link.download = `${title.replace(/\s+/g, "_")}_${timestamp}.csv`;
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
    }
  </script>
</body>
</html>
